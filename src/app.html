<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>vnavarro.dev</title>
    <link rel="icon" href="%sveltekit.assets%/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    %sveltekit.head%
  </head>
  <body data-sveltekit-preload-data="hover">
    <div style="display: contents">%sveltekit.body%</div>
    <script>
      // Prevent FOUC by applying theme immediately
      ;(function () {
        function applyTheme(themeValue) {
          if (themeValue === 'dark') {
            document.documentElement.classList.add('dark')
            // Remove existing highlight.js stylesheets
            const existingLinks = document.querySelectorAll('link[href*="highlight.js/styles"]')
            existingLinks.forEach((link) => link.remove())
            // Add dark theme
            const link = document.createElement('link')
            link.rel = 'stylesheet'
            link.href =
              'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css'
            document.head.appendChild(link)
          } else {
            document.documentElement.classList.remove('dark')
            // Remove existing highlight.js stylesheets
            const existingLinks = document.querySelectorAll('link[href*="highlight.js/styles"]')
            existingLinks.forEach((link) => link.remove())
            // Add light theme
            const link = document.createElement('link')
            link.rel = 'stylesheet'
            link.href =
              'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css'
            document.head.appendChild(link)
          }
        }

        // Apply initial theme from localStorage or system preference
        const savedTheme = localStorage.getItem('theme')
        let initialTheme = 'light'

        if (savedTheme && (savedTheme === 'light' || savedTheme === 'dark')) {
          initialTheme = savedTheme
        } else {
          // Check system preference
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches
          initialTheme = prefersDark ? 'dark' : 'light'
        }

        applyTheme(initialTheme)

        // Make the function globally available for your Svelte component
        window.applyThemeGlobally = applyTheme
      })()
    </script>
  </body>
</html>
